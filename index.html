<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What to Pray</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            color: #333;
        }

        textarea {
            width: 80%;
            height: 100px;
            margin: 20px auto;
            padding: 10px;
            font-size: 16px;
        }

        button {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            margin: 10px 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        #response {
            margin-top: 30px;
            text-align: left;
            font-size: 18px;
            color: #555;
            white-space: pre-line;
            display: inline-block;
            max-width: 80%;
        }

        #response h2 {
            color: #007BFF;
            margin-bottom: 5px;
        }

        #response p {
            margin: 10px 0;
            line-height: 1.6;
        }

        #response hr {
            border: 0;
            border-top: 1px solid #ddd;
            margin: 20px 0;
        }

        .button-container {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>What to Pray</h1>
    <p>Enter your situation below, and receive prayers and saints to guide you.</p>

    <!-- Text Input Area -->
    <textarea id="userInput" placeholder="Describe your situation here..."></textarea>

    <!-- Buttons Container -->
    <div class="button-container">
        <button onclick="getPrayer()">Submit</button>
        <button onclick="regeneratePrayer()" id="regenerateBtn" style="display:none;">Regenerate</button>
    </div>

    <!-- Display AI Response -->
    <div id="response"></div>

    <!-- JavaScript -->
    <script>
        let currentSituation = ""; // To store the user's input

        async function getPrayer() {
            const userInput = document.getElementById("userInput").value;

            if (!userInput.trim()) {
                document.getElementById("response").innerText = "Please enter your situation.";
                return;
            }

            currentSituation = userInput; // Store input for regeneration
            document.getElementById("response").innerText = "Generating prayers...";
            document.getElementById("regenerateBtn").style.display = "none"; // Hide Regenerate button while loading

            await fetchPrayerResponse(userInput);
        }

        async function regeneratePrayer() {
            if (currentSituation.trim()) {
                document.getElementById("response").innerText = "Regenerating response...";
                await fetchPrayerResponse(currentSituation);
            }
        }

        async function fetchPrayerResponse(userInput) {
    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer YOUR_BACKEND_KEY_HER" // Replace with your API key
            },
            body: JSON.stringify({
                model: "gpt-3.5-turbo",
                messages: [
                    {
                        role: "user",
                        content: `
                        Based on the following situation: "${userInput}", regenerate a **unique and alternative response** that includes:
                        1. A different relevant Bible verse, including the full text, book, chapter, and verse number.
                        2. A fresh, alternative Christian prayer of at least 4-6 sentences that reflects the user's situation, providing comfort, guidance, and strength.
                        3. The name of a different Patron Saint related to this topic, with a unique 2-3 sentence description of their patronage and why they are relevant.
                        4. A new, alternative prayer (4-6 sentences) to this Patron Saint, asking for their intercession and help regarding the given situation.

                        Each response must be distinct from any prior ones while still remaining applicable to the situation.

                        Format the response as follows:
                        - Bible Verse: [Full text with book, chapter, and verse number]
                        - Prayer: [A detailed prayer based on the situation]
                        - Patron Saint: [Saint's name and a detailed description of their patronage]
                        - Prayer to the Patron Saint: [A detailed prayer addressing the Patron Saint]
                        `
                    }
                ],
                temperature: 1.2 // Increased for more creativity and variety
            })
        });

        const data = await response.json();
        console.log(data); // Log the full response for debugging

        if (response.ok && data.choices && data.choices.length > 0) {
            const prayers = data.choices[0].message.content || "No response generated.";

            // Organize the response into sections
            const formattedResponse = prayers
                .replace(/- Bible Verse:/, '<h2>Bible Verse</h2><p>')
                .replace(/- Prayer:/, '</p><hr><h2>Prayer</h2><p>')
                .replace(/- Patron Saint:/, '</p><hr><h2>Patron Saint</h2><p>')
                .replace(/- Prayer to the Patron Saint:/, '</p><hr><h2>Prayer to the Patron Saint</h2><p>')
                .concat('</p>');

            document.getElementById("response").innerHTML = formattedResponse;
            document.getElementById("regenerateBtn").style.display = "inline"; // Show Regenerate button
        } else {
            document.getElementById("response").innerText = `Error: ${data.error?.message || "Invalid response from AI."}`;
        }

    } catch (error) {
        console.error("Error:", error);
        document.getElementById("response").innerText = "An error occurred. Please check your connection or API key.";
    }
}
    </script>
</body>
</html>
